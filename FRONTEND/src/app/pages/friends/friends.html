<app-navbar></app-navbar>

<div class="friends-container fade-in">
  
  <div class="friends-header">
    <h1>Social</h1>
    
    <div class="search-bar-global">
      <input type="text" placeholder="ğŸ” Buscar personas..." [(ngModel)]="searchTerm" (input)="filterUsers()">
    </div>

    <div class="tabs">
      <button [class.active]="activeTab === 'my-friends'" (click)="setTab('my-friends')">
        Mis Amigos ({{ filteredFriends.length }})
      </button>
      <button [class.active]="activeTab === 'explore'" (click)="setTab('explore')">
        Explorar
      </button>
    </div>
  </div>

  <div *ngIf="activeTab === 'my-friends'" class="tab-content fade-in">
    
    <div *ngIf="filteredFriends.length === 0" class="empty-state">
      <p>No se encontraron amigos.</p>
    </div>

    <div class="users-grid">
      <div class="user-card friend-card" *ngFor="let friend of filteredFriends">
        <img [src]="friend.avatarUrl || 'https://cdn-icons-png.flaticon.com/512/149/149071.png'" alt="Avatar">
        <div class="user-info">
          <h3>{{ friend.userName }}</h3>
          <p class="friend-badge">âœ… Amigos</p>
        </div>
        
        <div class="card-actions">
          <button class="btn-chat" (click)="openChat(friend)">ğŸ’¬ Chat</button>
          <button class="btn-delete-icon" (click)="openDeleteConfirm(friend)" title="Eliminar amigo">ğŸ—‘ï¸</button>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="activeTab === 'explore'" class="tab-content fade-in">
    
    <div *ngIf="isLoading" class="loading">Cargando usuarios...</div>

    <div class="users-grid" *ngIf="!isLoading">
      <div class="user-card" *ngFor="let user of filteredExplore">
        <img [src]="user.avatarUrl || 'https://cdn-icons-png.flaticon.com/512/149/149071.png'" alt="Avatar">
        <div class="user-info">
          <h3>{{ user.userName }}</h3>
          <p *ngIf="user.bio">{{ user.bio }}</p>
        </div>
        
        <button 
          class="btn-add" 
          [disabled]="user.requestStatus === 'pending'"
          [class.pending]="user.requestStatus === 'pending'"
          (click)="sendRequest(user)">
          {{ user.requestStatus === 'pending' ? 'Pendiente ğŸ•’' : 'AÃ±adir â•' }}
        </button>
      </div>
    </div>
  </div>

</div> 

<app-chat 
  *ngIf="chatFriend" 
  [friend]="chatFriend" 
  [myId]="currentUser.id"
  (close)="closeChat()">
</app-chat>

<div class="modal-overlay" *ngIf="showDeleteModal">
  <div class="modal-content"> <h2 style="color: #dc2626; margin-top:0;">Â¿Eliminar Amigo?</h2>
    <p>Â¿Seguro que quieres eliminar a <strong>{{ friendToDelete?.userName }}</strong> de tu lista de amigos?</p>
    
    <div class="modal-actions">
      <button class="btn-cancel" (click)="closeDeleteModal()">Cancelar</button>
      <button class="btn-danger" (click)="confirmDelete()">SÃ­, Eliminar</button>
    </div>
  </div>
</div>

<app-footer></app-footer>