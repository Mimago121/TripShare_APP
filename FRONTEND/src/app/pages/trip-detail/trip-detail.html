<app-navbar></app-navbar>

<div class="trip-detail-container" *ngIf="trip && !isLoading">
  
  <div class="trip-hero">
    <div class="hero-content">
      <a routerLink="/trips" class="back-link">â† Volver a Mis Viajes</a>
      <h1>{{ trip.name }}</h1>
      <div class="hero-info">
        <span class="badge-location">ğŸ“ {{ trip.origin ? trip.origin + ' â” ' : '' }}{{ trip.destination }}</span>
        <span class="badge-date">ğŸ“… {{ trip.startDate | date:'mediumDate' }} al {{ trip.endDate | date:'mediumDate' }}</span>
      </div>
    </div>
  </div>

  <div class="tabs-nav">
    <button [class.active]="activeTab === 'itinerary'" (click)="setTab('itinerary')">ğŸ—“ï¸ Itinerario</button>
    <button [class.active]="activeTab === 'expenses'" (click)="setTab('expenses')">ğŸ’¸ Gastos</button>
    <button [class.active]="activeTab === 'memories'" (click)="setTab('memories')">ğŸ“¸ Recuerdos</button>
  </div>

  <div class="tab-content">

    <div *ngIf="activeTab === 'itinerary'" class="content-section">
      <div class="section-header">
        <h2>Itinerario y Actividades</h2>
        <button class="btn-outline-small" (click)="openModal('activity')">+ AÃ±adir</button>
      </div>
      
      <div class="empty-state" *ngIf="activities.length === 0">No hay actividades programadas.</div>
      
      <div class="activity-list">
        <div class="activity-card" *ngFor="let act of activities">
          <div class="time-block">
            <strong>{{ act.startDatetime | date:'HH:mm' }}</strong>
            <small>{{ act.startDatetime | date:'dd MMM' }}</small>
          </div>
          <div class="act-details">
            <h4>{{ act.title }}</h4>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="activeTab === 'expenses'" class="content-section">
      <div class="section-header">
        <h2>Control de Gastos</h2>
        <button class="btn-outline-small" (click)="openModal('expense')">+ AÃ±adir Gasto</button>
      </div>

      <div class="empty-state" *ngIf="expenses.length === 0">No hay gastos registrados.</div>

      <div class="expense-list">
        <div class="expense-item" *ngFor="let exp of expenses">
          <div class="exp-icon">ğŸ›’</div>
          <div class="exp-info">
            <strong>{{ exp.description }}</strong>
            <small>Pagado por ID: {{ exp.paidByUserId }}</small>
          </div>
          <div class="exp-amount">{{ exp.amount }} â‚¬</div>
        </div>
      </div>
    </div>

    <div *ngIf="activeTab === 'memories'" class="content-section">
      <div class="section-header">
        <h2>Ãlbum de Recuerdos</h2>
        <button class="btn-outline-small" (click)="openModal('memory')">+ Subir Foto</button>
      </div>

      <div class="empty-state" *ngIf="memories.length === 0">AÃºn no hay fotos o notas.</div>

      <div class="memories-grid">
        <div class="memory-card" *ngFor="let mem of memories">
          <img *ngIf="mem.type === 'photo'" [src]="mem.mediaUrl" alt="Memoria">
          <div class="memory-note" *ngIf="mem.type === 'note'">
            ğŸ“ {{ mem.description }}
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<div class="loading-state" *ngIf="isLoading">
  <div class="spinner"></div>
</div>

<div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    
    <button class="close-btn" (click)="closeModal()">âœ•</button>

    <div *ngIf="modalType === 'activity'">
      <h2>Nueva Actividad ğŸ—“ï¸</h2>
      <div class="form-group">
        <label>TÃ­tulo *</label>
        <input type="text" [(ngModel)]="newActivity.title" placeholder="Ej: Visita al Coliseo">
      </div>
      <div class="form-row">
        <div class="form-group half">
          <label>Inicio *</label>
          <input type="datetime-local" [(ngModel)]="newActivity.start">
        </div>
        <div class="form-group half">
          <label>Fin (Opcional)</label>
          <input type="datetime-local" [(ngModel)]="newActivity.end">
        </div>
      </div>
      <button class="btn-primary full-width" (click)="saveActivity()">Guardar Actividad</button>
    </div>

    <div *ngIf="modalType === 'expense'">
      <h2>Nuevo Gasto ğŸ’¸</h2>
      <div class="form-group">
        <label>Concepto *</label>
        <input type="text" [(ngModel)]="newExpense.description" placeholder="Ej: Cena del viernes">
      </div>
      <div class="form-group">
        <label>Cantidad (â‚¬) *</label>
        <input type="number" [(ngModel)]="newExpense.amount" placeholder="0.00">
      </div>
      <button class="btn-primary full-width" (click)="saveExpense()">Guardar Gasto</button>
    </div>

    <div *ngIf="modalType === 'memory'">
      <h2>Nuevo Recuerdo ğŸ“¸</h2>
      <div class="form-group">
        <label>Tipo</label>
        <select [(ngModel)]="newMemory.type">
          <option value="photo">Foto</option>
          <option value="note">Nota de texto</option>
        </select>
      </div>

      <div class="form-group" *ngIf="newMemory.type === 'photo'">
        <label>URL de la imagen (Opcional)</label>
        <input type="text" [(ngModel)]="newMemory.url" placeholder="https://...">
        <small>Si lo dejas vacÃ­o, se pondrÃ¡ una aleatoria.</small>
      </div>

      <div class="form-group">
        <label>DescripciÃ³n / Nota *</label>
        <textarea rows="3" [(ngModel)]="newMemory.description" placeholder="Escribe aquÃ­..."></textarea>
      </div>
      
      <button class="btn-primary full-width" (click)="saveMemory()">Guardar Recuerdo</button>
    </div>

  </div>
</div>

<app-footer></app-footer>