<div class="page-layout">
  <app-navbar></app-navbar>

  <main class="main-content">
    
    <div class="profile-card fade-in">
      
      <div class="profile-cover">
        <img [src]="user.coverUrl || 'https://images.unsplash.com/photo-1476514525535-07fb3b4ae5f1?q=80&w=2000'" alt="Cover" class="cover-img">
        <button class="btn-edit-cover" (click)="openEditModal()">üì∑ Cambiar portada</button>
      </div>

      <div class="profile-header-content">
        <div class="avatar-wrapper">
          <img [src]="user.avatarUrl || 'https://ui-avatars.com/api/?name=' + user.userName + '&background=random&color=fff&size=150'" alt="Profile" class="avatar-img">
        </div>

        <div class="user-details">
          <div class="name-row">
            <h1>{{ user.userName }} <span class="badge-pro">PRO</span></h1>
            <button class="btn-edit-profile" (click)="openEditModal()">‚úèÔ∏è Editar perfil</button>
          </div>
          <p class="user-handle">@{{ user.userName | lowercase }} ‚Ä¢ Unido en 2024</p>
          <p class="user-bio">{{ user.bio || 'Sin biograf√≠a a√∫n. ¬°Escribe algo sobre ti!' }}</p>
          
          <div class="location-row" *ngIf="user.location">
            üìç {{ user.location }}
          </div>
        </div>
      </div>

      <div class="profile-stats">
        <div class="stat-item">
          <span class="stat-num">{{ stats.countries }}</span>
          <span class="stat-label">Destinos</span>
        </div>
        <div class="stat-item">
          <span class="stat-num">{{ stats.trips }}</span>
          <span class="stat-label">Viajes</span>
        </div>
        <div class="stat-item">
          <span class="stat-num">{{ stats.friends }}</span>
          <span class="stat-label">Amigos</span>
        </div>
      </div>

      <div class="profile-tabs">
        <button class="tab-link" [class.active]="activeTab === 'trips'" (click)="setActiveTab('trips')">Mis Viajes</button>
        <button class="tab-link" [class.active]="activeTab === 'photos'" (click)="setActiveTab('photos')">Fotos</button>
        <button class="tab-link" [class.active]="activeTab === 'map'" (click)="setActiveTab('map')">Mapa Mundial</button>
      </div>
    </div>

    <section class="profile-body fade-in" *ngIf="activeTab === 'trips'">
      <div class="trips-grid">
        
        <div class="trip-card create-new" routerLink="/trips">
          <div class="plus-circle">+</div>
          <h3>Planear nuevo viaje</h3>
        </div>

        <div class="trip-card" *ngFor="let trip of myTrips">
          <div class="card-img-wrapper">
            <img [src]="trip.image" [alt]="trip.title">
            <span class="trip-date">{{ trip.date }}</span>
          </div>
          <div class="card-info">
            <h3>{{ trip.title }}</h3>
            <div class="card-meta">
              <span>‚úàÔ∏è {{ trip.destination }}</span>
            </div>
          </div>
        </div>

      </div>
    </section>

    <section class="profile-body fade-in" *ngIf="activeTab === 'photos'">
      <div class="profile-section" style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 4px 12px rgba(0,0,0,0.05);">
        
        <div class="empty-state" *ngIf="myPhotos.length === 0" style="text-align: center; padding: 40px; color: #666;">
          A√∫n no has subido ninguna foto a tus viajes.
        </div>

        <div class="memories-grid" *ngIf="myPhotos.length > 0" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px;">
          <div class="memory-card" *ngFor="let photo of myPhotos" style="border-radius: 12px; overflow: hidden; background: #f8f9fa; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
            <img [src]="photo.mediaUrl" alt="Recuerdo de viaje" style="width: 100%; height: 200px; object-fit: cover; display: block;">
            
            <div class="memory-caption" *ngIf="photo.description" style="padding: 12px; font-size: 14px; color: #333; text-align: center;">
              {{ photo.description }}
            </div>
          </div>
        </div>

      </div>
    </section>

    <section class="profile-body fade-in" *ngIf="activeTab === 'map'">
      <div class="world-map-container">
        <div class="map-header">
            <div>
                <h3>üåç Mi Mapa de Viajes</h3>
                <p>Has marcado {{ tripMarkers.length }} destinos en el mundo.</p>
            </div>
            
            <div class="add-pin-box">
                <input 
                    type="text" 
                    [(ngModel)]="newPlaceName" 
                    (keyup.enter)="addPlace()"
                    placeholder="Ej: Kioto, Jap√≥n...">
                <button class="btn-primary-small" (click)="addPlace()">+ Pin</button>
            </div>
        </div>
        
        <div class="map-frame">
            <google-map 
                height="500px" 
                width="100%" 
                [options]="worldMapOptions">
                
                <map-marker 
                    *ngFor="let marker of tripMarkers" 
                    [position]="marker.position"
                    [title]="marker.title"
                    [icon]="marker.icon">
                </map-marker>

            </google-map>
        </div>
      </div>
    </section>

  </main>

  <app-footer></app-footer>

  <div class="modal-overlay" *ngIf="isEditModalOpen">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Editar Perfil</h2>
        <button class="btn-close" (click)="closeEditModal()">‚úï</button>
      </div>
      
      <div class="form-row">
        <div class="form-group half">
          <label>Foto de Perfil</label>
          <input type="file" (change)="onFileSelected($event, 'avatar')" accept="image/*" class="custom-file-input">
          <div class="image-preview" *ngIf="user.avatarUrl" style="display: flex; justify-content: center;">
            <img [src]="user.avatarUrl" alt="Avatar" style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover;">
          </div>
        </div>
        
        <div class="form-group half">
          <label>Foto de Portada</label>
          <input type="file" (change)="onFileSelected($event, 'cover')" accept="image/*" class="custom-file-input">
          <div class="image-preview" *ngIf="user.coverUrl">
            <img [src]="user.coverUrl" alt="Portada" style="height: 80px; width: 100%; object-fit: cover; border-radius: 8px;">
          </div>
        </div>
      </div>

      <div class="form-group">
        <label>Nombre de Usuario</label>
        <input type="text" [(ngModel)]="user.userName">
      </div>
      <div class="form-group">
        <label>Biograf√≠a</label>
        <textarea [(ngModel)]="user.bio" rows="3" placeholder="Cu√©ntanos sobre ti..."></textarea>
      </div>

      <div class="modal-actions">
        <button class="btn-cancel" (click)="closeEditModal()">Cancelar</button>
        <button class="btn-save" (click)="saveProfile()">Guardar Cambios</button>
      </div>
    </div>
  </div>
</div>